<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Janadikar — Dashboard</title>

  <!-- Bootstrap & FontAwesome -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

  <!-- Leaflet (Map) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    :root {
      --navy: #06314a;
      --muted: #6c757d;
      --saffron: #FF9933;
      --green: #138808;
      --accent: #07b02b;
      --glass: rgba(255, 255, 255, 0.88);
    }

    html,
    body {
      height: 100%;
      margin: 0;
      font-family: Inter, sans-serif;
      background: linear-gradient(180deg, #f6fbff, #eef6ff);
      color: #072033;
    }

    /* Sidebar */
    .sidebar {
      width: 240px;
      height: 100vh;
      background: #0A2647;
      color: #fff;
      position: fixed;
      top: 0;
      left: 0;
      padding-top: 25px;
      overflow-y: auto;
      transition: all 0.3s;
    }

    .sidebar h3 {
      text-align: center;
      color: #FFDE59;
      margin-bottom: 25px;
      font-size: 22px;
      font-weight: bold;
    }

    .menu-item {
      color: #fff;
      padding: 12px 20px;
      display: flex;
      align-items: center;
      text-decoration: none;
      border-radius: 5px;
      margin: 2px 10px;
      transition: 0.3s;
    }

    .menu-item i {
      margin-right: 10px;
    }

    .menu-item:hover,
    .menu-item.active {
      background: #144272;
    }

    /* Navbar */
    .rs-navbar {
      background: var(--glass);
      backdrop-filter: blur(6px);
      border-bottom: 1px solid rgba(7, 32, 50, 0.06);
      position: fixed;
      top: 0;
      left: 240px;
      right: 0;
      z-index: 1050;
      transition: left 0.3s;
    }

    @media(max-width:768px) {
      .rs-navbar {
        left: 0;
      }
    }

    .brand {
      display: flex;
      gap: .6rem;
      align-items: center;
      font-weight: 700;
      color: var(--navy);
    }

    .brand img {
      height: 44px;
    }

    /* App content */
    .app-wrap {
      margin-left: 260px;
      padding: 100px 20px 20px 20px;
      /* top padding for fixed navbar */
      transition: margin-left 0.3s;
    }

    @media(max-width:1024px) {
      .app-wrap {
        margin-left: 250px;
        padding-top: 100px;
      }
    }

    @media(max-width:768px) {
      .app-wrap {
        margin-left: 0;
        padding-top: 100px;
      }
    }

    /* Hero / header */
    .hero {
      background: linear-gradient(180deg, #07324b, #0b4d6b);
      color: #fff;
      padding: 26px 18px;
      border-radius: 0 0 10px 10px;
      box-shadow: 0 10px 30px rgba(6, 49, 74, 0.12);
    }

    .hero .title {
      font-size: 1.6rem;
      font-weight: 700;
      margin: 0;
    }

    .hero .subtitle {
      opacity: 0.9;
      margin-top: 6px;
    }

    /* Card shells */
    .card-shell {
      background: var(--glass);
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 8px 22px rgba(9, 33, 56, 0.06);
      border: 1px solid rgba(11, 37, 64, 0.04);
      margin-bottom: 20px;
    }

    /* Map height */
    #map {
      height: 400px;
      border-radius: 10px;
    }

    /* Update card styles */
    .update-card {
      margin-bottom: 16px;
      padding: 12px;
      border-radius: 10px;
      background: #fff;
      box-shadow: 0 3px 12px rgba(0, 0, 0, 0.05);
    }

    .tag-trend {
      background: #ff5733;
      color: #fff;
      padding: 2px 6px;
      font-size: 10px;
      border-radius: 4px;
      font-weight: 700;
    }

    .small-muted {
      color: #6c757d;
      font-size: 0.85rem;
    }
  </style>
</head>

<body>

  <!-- SIDEBAR -->
  <div class="sidebar">
    <h3>RashtraSetu</h3>
    <a href="../index.html" class="menu-item"><i class="fa-solid fa-house"></i>Home</a>
    <a href="search.html" class="menu-item"><i class="fa-solid fa-search"></i>Search</a>
    <a href="explore.html" class="menu-item"><i class="fa-solid fa-compass"></i>Explore</a>
    <a href="add-issue.html" class="menu-item"><i class="fa-solid fa-plus-circle"></i>Add Issues</a>
    <a href="add-bill.html" class="menu-item"><i class="fa-solid fa-plus-circle"></i>Add Bills</a>
    <a href="janadicar-final.html" class="menu-item"><i class="fa-solid fa-gavel"></i>Janadhikar</a>
    <a href="about_our_leaders.html" class="menu-item"><i class="fa-solid fa-users"></i>About Our Leaders</a>
    <a href="politician_property.html" class="menu-item"><i class="fa-solid fa-user-tie"></i>Politician Properties</a>
    <a href="Updates.html" class="menu-item"><i class="fa-solid fa-bell"></i>Updates</a>
    <a href="profile.html" class="menu-item"><i class="fa-solid fa-user"></i>Profile</a>
    <a href="#" onclick="logout" class="menu-item"><i class="fa-solid fa-right-from-bracket"></i>Logout</a>
    <script>
      function logout() {
        localstorage.clear()
        window.location.href = "../index.html"
      }
    </script>
  </div>


  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg rs-navbar">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center gap-2" href="#">
        <div
          style="width:50px; height:60px; display:flex; align-items:center; justify-content:center; overflow:hidden; border-radius:4px; background:#fff;">
          <img src="national.png" alt="National Emblem" style="width:auto; height:100%;">
        </div>
        <div class="d-flex flex-column">
          <span style="font-size:13px;color:#6b7b8a;">Janadikar</span>
          <span style="font-size:17px;color:var(--navy);font-weight:700;">Rights & Updates</span>
        </div>
      </a>

      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarContent">
        <div class="ms-auto d-flex flex-wrap align-items-center gap-2">
          <select id="districtSelect" class="form-select form-select-sm" style="min-width:180px;">
            <option value="all">All Districts</option>
            <option value="Pune">Pune</option>
            <option value="Mumbai">Mumbai</option>
            <option value="Nagpur">Nagpur</option>
            <option value="Nashik">Nashik</option>
          </select>

          <div class="dropdown">
            <button class="btn btn-light btn-sm position-relative" id="notifBtn" data-bs-toggle="dropdown">
              <i class="fa fa-bell"></i>
              <span id="notifCount"
                class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span>
            </button>
            <ul class="dropdown-menu dropdown-menu-end p-2" aria-labelledby="notifBtn" style="min-width:260px;">
              <li class="mb-2"><strong>Notifications</strong></li>
              <li class="dropdown-item small-muted" id="notifList">No new notifications</li>
            </ul>
          </div>

          <button class="btn btn-primary btn-sm"><i class="fa fa-plus-circle"></i> Add</button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content Wrapper -->
  <div class="app-wrap">
    <!-- Hero -->
    <header class="hero">
      <div class="container">
        <div class="title">Citizen Rights & Updates</div>
        <div class="subtitle">All official notices and public information at your fingertips.</div>
      </div>
    </header>

    <!-- Stats & Quick Actions -->
    <section class="row gy-3 mt-4">
      <div class="col-12">
        <div class="card-shell d-flex flex-wrap justify-content-between gap-3">
          <div class="d-flex gap-3 flex-wrap">
            <div class="stat" aria-hidden="true">
              <div class="icon"><i class="fa fa-building"></i></div>
              <div>
                <div class="small-muted">Active Projects</div>
                <div style="font-weight:700;font-size:18px;" id="statProjects">24</div>
              </div>
            </div>
            <div class="stat" aria-hidden="true">
              <div class="icon"><i class="fa fa-file-alt"></i></div>
              <div>
                <div class="small-muted">Policy Updates (30d)</div>
                <div style="font-weight:700;font-size:18px;" id="statPolicies">6</div>
              </div>
            </div>
            <div class="stat" aria-hidden="true">
              <div class="icon"><i class="fa fa-bell"></i></div>
              <div>
                <div class="small-muted">Public Notices</div>
                <div style="font-weight:700;font-size:18px;" id="statNotices">12</div>
              </div>
            </div>
          </div>

          <div class="d-flex gap-2 align-items-center">
            <button class="btn btn-outline-secondary btn-sm" onclick="exportPDF()"
              title="Export visible updates">Export</button>
            <button class="btn btn-outline-info btn-sm" onclick="subscribe()"
              title="Subscribe for updates">Subscribe</button>
            <button class="btn btn-primary btn-sm" onclick="openReport()" title="Report an issue">Report Issue</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Filters -->
    <!-- Filters -->
    <section class="row gy-3 mt-3">
      <div class="col-12">
        <div class="card-shell d-flex flex-wrap gap-3 align-items-center">

          <!-- SEARCH BY TITLE -->
          <div class="input-group" style="max-width:320px;">
            <input id="titleSearch" class="form-control form-control-sm" placeholder="Search by title"
              oninput="applyFilters()" />
            <button class="btn btn-sm btn-primary" onclick="applyFilters()">
              <i class="fa fa-search"></i>
            </button>
          </div>

          <!-- STATUS FILTER -->
          <select id="statusFilter" class="form-select form-select-sm" style="max-width:160px;"
            onchange="applyFilters()">
            <option value="">ALL STATUS</option>
            <option value="OPEN">OPEN</option>
            <option value="INPROGRESS">IN_PROGRESS</option>
            <option value="CLOSED">CLOSED</option>
          </select>

          <!-- PINCODE FILTER -->
          <input id="pincodeFilter" class="form-control form-control-sm" placeholder="Filter by pincode"
            style="max-width:160px;" oninput="applyFilters()" />

          <!-- DATE SORT -->
          <select id="dateSort" class="form-select form-select-sm" style="max-width:170px;" onchange="applyFilters()">
            <option value="recent">Most Recent</option>
            <option value="oldest">Oldest</option>
          </select>

        </div>
      </div>
    </section>


    <!-- Updates + Right sidebar -->
    <section class="row gy-3 mt-3">
      <div class="col-lg-8">
        <div class="card-shell">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
              <h2 style="margin:0;font-size:1.05rem;">Updates</h2>
              <div class="small-muted">Authoritative updates & community-sourced reports.</div>
            </div>
            <div class="small-muted">Last sync: <strong id="lastSync">05-Dec-2025</strong></div>
          </div>

          <!-- Updates grid -->
          <div id="updatesGrid" aria-live="polite" role="list"></div>

          <!-- pagination / load more -->
          
        </div>
      </div>

      <!-- Right sidebar -->
      <aside class="col-lg-4">
        <div class="card-shell mb-3">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h3 style="margin:0;font-size:1rem;">Breaking Alerts</h3>
            <button class="btn btn-sm btn-outline-secondary" onclick="clearAlerts()">Clear</button>
          </div>
          <div id="breakingBox" style="background:#fff8f5;padding:10px;border-radius:8px;">
            <div class="small-muted" id="breakingText">No active breaking alerts</div>
          </div>
        </div>

        <div class="card-shell mb-3">
          <h3 style="margin:0;font-size:1rem;">Recent Timeline</h3>
          <div class="timeline mt-2" id="timelineBox" aria-live="polite"></div>
        </div>

        <div class="card-shell">
          <h3 style="margin:0;font-size:1rem;">Quick Links</h3>
          <ul class="list-unstyled small-muted mt-2" style="padding-left:0;">
            <li><a href="#" class="text-decoration-none">Official Circulars</a></li>
            <li><a href="#" class="text-decoration-none">Citizen Charter</a></li>
            <li><a href="#" class="text-decoration-none">Report an Issue</a></li>
          </ul>
        </div>
      </aside>
    </section>

    <!-- Map -->
    <section class="row gy-3 mt-3">
      <div class="col-12">
        <div class="card-shell">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
              <h2 style="margin:0;font-size:1.05rem;">Map & District Progress</h2>
              <div class="small-muted">Interactive district view — click markers to open update details.</div>
            </div>
            <div class="small-muted">Tip: Use district selector in the top bar to filter.</div>
          </div>
          <div id="map"></div>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <footer class="mt-4">
      <div style="max-width:1100px;margin:0 auto;">
        <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;">
          <div>
            <div style="font-weight:700;">RashtraSetu</div>
            <div class="small-muted">Official updates hub for citizens</div>
          </div>
          <div class="small-muted">Helpline: 1800-XXX-XXXX • Email: support@rashtrasetu.example</div>
        </div>
      </div>
    </footer>
  </div>

  <!-- Bootstrap JS & Leaflet -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Your script goes here (unchanged, just paste your JS) -->
  <script>

    let issues = [];
    /* ---------------------------
   Data (sample client-side dataset)
   Replace with real API calls in production
--------------------------- */
window.onload = async () => {
  const res = await fetch("https://viraj-backend.onrender.com/api/all-issues");
  issues = (await res.json()).issues;
  applyFilters();
};  
  // ---- REQUIRED HELPERS (DO NOT REMOVE) ----
  const el = (id) => document.getElementById(id);

  function escapeHtml(str = "") {
    return str
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;");
  }

  function shorten(text = "", len = 200) {
    return text.length > len ? text.slice(0, len) + "..." : text;
  }

  function formatDate(date) {
    return new Date(date).toLocaleDateString("en-GB");
  }

  function varToRgb(varName, fallback) {
    const v = getComputedStyle(document.documentElement)
      .getPropertyValue(varName);
    return v ? v.trim() : fallback;
  }
    function renderUpdatesGrid(list) {
        const container = el('updatesGrid');
        container.innerHTML = '';
        if (list.length === 0) {
          container.innerHTML = '<div class="small-muted p-3">No updates match your filters.</div>';
          return;
        }

        list.forEach(u => {
          console.log(u);
          const card = document.createElement('article');
          card.className = 'update-card';
          // border color
          let border = u.category === 'project' ? '6px solid ' + varToRgb('--accent', '#07b02b') : u.category === 'law' ? '6px solid #ffcc00' : '6px solid #34b3ff';
          card.style.borderLeft = border;

          card.innerHTML = `
      <div style="display:flex; justify-content:space-between; gap:12px; align-items:flex-start;">
        <div style="flex:1;">
          <div style="font-weight:700; font-size:16px;">${escapeHtml(u.title)}</div>
          <div class="small-muted" style="margin-top:6px;">${formatDate(u.createdAt)}</div>
          <p class="small-muted" style="margin-top:8px;">${escapeHtml(shorten(u.desc, 190))}</p>
        </div>
      </div>
    `;
          container.appendChild(card);
        });
      }


function applyFilters() {
  const titleQuery = document.getElementById("titleSearch").value.toLowerCase();
  const statusFilter = document.getElementById("statusFilter").value.toUpperCase();
  const pincodeFilter = document.getElementById("pincodeFilter").value.trim();
  const dateSort = document.getElementById("dateSort").value;

  let filtered = issues.filter(issue => {
    if (titleQuery && !issue.title?.toLowerCase().includes(titleQuery)) return false;
    if (statusFilter && issue.status?.toUpperCase() !== statusFilter) return false;
    if (pincodeFilter && !issue.pincode?.includes(pincodeFilter)) return false;
    return true;
  });

  filtered.sort((a, b) =>
    dateSort === "recent"
      ? new Date(b.createdAt) - new Date(a.createdAt)
      : new Date(a.createdAt) - new Date(b.createdAt)
  );

  renderUpdatesGrid(filtered);
}

  </script>

  <!-- Details Modal -->
  <div class="modal fade" id="detailsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="detailsTitle">Update Details</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="detailsBody"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Report Modal -->
  <div class="modal fade" id="reportModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Report an Issue</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <textarea id="rMsg" class="form-control" rows="5" placeholder="Describe the issue..."></textarea>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary btn-sm" onclick="submitReport()">Submit</button>
          <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Feedback Modal -->
  <div class="modal fade" id="feedbackModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Feedback</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <textarea id="fMsg" class="form-control" rows="5" placeholder="Write your feedback..."></textarea>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary btn-sm" onclick="submitFeedback()">Submit</button>
          <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Admin / Add Update Modal -->
  <div class="modal fade" id="adminModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add New Update</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-2">
            <input id="aTitle" class="form-control" placeholder="Title">
          </div>
          <div class="mb-2">
            <select id="aCategory" class="form-select">
              <option value="project">Project</option>
              <option value="law">Law</option>
              <option value="notice">Notice</option>
            </select>
          </div>
          <div class="mb-2">
            <input id="aDistrict" class="form-control" placeholder="District (All if none)">
          </div>
          <div class="mb-2">
            <textarea id="aDesc" class="form-control" rows="4" placeholder="Description"></textarea>
          </div>
          <div class="mb-2">
            <input id="aProgress" type="number" class="form-control" placeholder="Progress (0-100)">
          </div>
          <div class="mb-2">
            <input id="aDate" type="date" class="form-control">
          </div>
          <div class="form-check mb-2">
            <input type="checkbox" class="form-check-input" id="aTrending">
            <label class="form-check-label" for="aTrending">Mark as Trending</label>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary btn-sm" onclick="addUpdate()">Add Update</button>
          <button class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

</body>

</html>